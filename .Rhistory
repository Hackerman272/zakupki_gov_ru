header = F, as.is = T)[1, ]))
colnames <- gsub(colnames, pattern = '\\.', replacement = '')
# команда импорта из csv
cat(paste0("import delimited ", csvDataFilesList[i], ", clear"),
file = doFilePath, append = TRUE, sep = '\n')
# делаем переменную Decision
cat(paste("generate int Decision = y >", low.lim),
file = doFilePath, append = TRUE, sep = '\n')
# заменяем значения ниже low.limit на 0
cat(paste("replace y = 0 if y <=", low.lim),
file = doFilePath, append = TRUE, sep = '\n')
# команда оценки параметров модели
if (spec == 1) {
cat(paste('heckman y ',
colnames[2], '-', colnames[length(colnames)],
', select(Decision = ',
colnames[2], '- reg_seaport ) iterate(20) noskip'),
file = doFilePath, append = TRUE, sep = '\n')
} else {
# команда оценки параметров модели
cat(paste('heckman y ',
colnames[2], '-', colnames[length(colnames)],
', select(Decision = ',
colnames[2], '- l_dist_co_reg ) iterate(20) noskip'),
file = doFilePath, append = TRUE, sep = '\n')
}
# сохраняем оценки
cat(paste0('estimates store ', model.names[i]),
file = doFilePath, append = TRUE, sep = '\n')
# записываем статистики в матрицу
#  количество наблюдений: всего
cat(paste0('mat t1[4, ', i, '] = e(N)'),
file = doFilePath, append = TRUE, sep = '\n')
#  количество наблюдений: цезурированных
cat(paste0('mat t1[5, ', i, '] = e(N_cens)'),
file = doFilePath, append = TRUE, sep = '\n')
#  лог функции правдоподобия
cat(paste0('mat t1[6, ', i, '] = e(ll)'),
file = doFilePath, append = TRUE, sep = '\n')
#  лог функции правдоподобия для модели с константой
cat(paste0('mat t1[7, ', i, '] = e(ll_0)'),
file = doFilePath, append = TRUE, sep = '\n')
# сошёлся ли алгоритм
cat(paste0('mat t1[8, ', i, '] = e(converged)'),
file = doFilePath, append = TRUE, sep = '\n')
# только первая часть (пробит)
cat(paste('qui probit Decision', colnames[2], '- l_dist_co_reg'),
file = doFilePath, append = TRUE, sep = '\n')
# считаем статистики качества классификации
cat('estat classification',
file = doFilePath, append = TRUE, sep = '\n')
# записываем статистики в матрицу
#  чувствительность
cat(paste0('mat t1[1, ', i, '] = r(P_p1)'),
file = doFilePath, append = TRUE, sep = '\n')
#  специфичность
cat(paste0('mat t1[2, ', i, '] = r(P_n0)'),
file = doFilePath, append = TRUE, sep = '\n')
#  точность
cat(paste0('mat t1[3, ', i, '] = r(P_corr)'),
file = doFilePath, append = TRUE, sep = '\n')
}
# таблица с коэффициентами всех моделей для экспорта в Excel
cat(paste('qui estimates table', paste(model.names, collapse = ' '),
', varlabel varwidth(25)  star(0.05 0.01 0.001) b(%6.1f)'),
file = doFilePath, append = TRUE, sep = '\n')
# закидываем в книгу Excel
#  коэффициенты
cat(paste0('putexcel A1=matrix(r(coef), names) using ',
excelResultsFilePath, ', sheet(coefs) modify'),
file = doFilePath, append = TRUE, sep = '\n')
#  статистики
cat(paste0('putexcel A1=matrix(t1, names) using ', excelResultsFilePath,
', sheet(stats) modify') ,
file = doFilePath, append = TRUE, sep = '\n')
cat('log close',
file = doFilePath, append = TRUE, sep = '\n')
}
# загрузка пакетов -------------------------------------------------------------
library('foreign')
library('data.table')
library('dplyr')
library('RColorBrewer')
library('lattice')
# рабочая директория -----------------------------------------------------------
#  -- та, в которой лежит этот файл
setwd("~/01_Projects/Checkpoints_FCS/R-Work")
# загрузка справочников --------------------------------------------------------
# ТН ВЭД =======================================================================
dt.tnved <- data.table(read.table('./data/reference/tnved.csv', header = T,
sep = '\t', as.is = T))
# для совмещения с таблицей импорта
dt.tnved[, code_tov := substr(KOD, 1, 4)]
dt.tnved <- dt.tnved[, c('code_tov', 'tov_emb')]
setkey(dt.tnved, code_tov)
dt.tnved <- unique(dt.tnved)
# координаты столиц стран-контрагентов =========================================
dt.co_or.coords <- as.data.table(read.csv('./data/reference/country_coords.csv',
as.is = T, sep = ';', dec = ',',
na.strings = '.'))
rownames(dt.co_or.coords) <- dt.co_or.coords$co_or
# координаты центров регионов ==================================================
dt.okato.coords <- as.data.table(read.csv('./data/reference/region_coords.csv',
as.is = T, sep = ';', dec = ',',
colClasses = c(rep('character', 2),
rep('numeric', 5))))
# добавляем ведущие нули
dt.okato.coords[nchar(okato) < 5, okato := paste0('0', okato[nchar(okato) < 5])]
rownames(dt.okato.coords) <- dt.okato.coords$okato
# координаты пропускных пунктов ================================================
dt.pp.coords <- as.data.table(read.csv('./data/reference/pp_coords.csv',
stringsAsFactors = F,
sep = ';', dec = ','))
# сопоставимая выборка пропускных пунктов ======================================
pp.names.13.15 <- readLines('./data/reference/pp.names_13_15.txt')
# типы переменных в исходных файлах ============================================
df.colclasses <- data.frame(varname = c("code_tov", "year", "code_organ",
"co_or", "code_tra", "name_pp",
"code_organ0", "code_tov10",
"code_okato", "ves_br", "ves_ne",
"stoim"),
class = c(rep('character', 9),
rep('numeric', 3)))
df.colclasses$varname <- as.character(df.colclasses$varname)
df.colclasses$class <- as.character(df.colclasses$class)
# виды транспорта ==============================================================
df.transport <- data.frame(code_tra = seq(10, 40, by = 10),
tran_name = c('мор', 'ж/д', 'а/м', 'воз'))
df.transport$code_tra <- as.character(df.transport$code_tra)
# функции создания наборов данных и оценки моделей =============================
eval(parse('./functions/functions_prepare_data_for_grav_and_pp.R',
encoding = "UTF-8"))
eval(parse('./functions/functions_create_data_set_for_grav_and_pp.R',
encoding = "UTF-8"))
# константы и функции ----------------------------------------------------------
# нижняя граница для цензурированных наблюдений ================================
low.limit <- 0
# период агрегирования =========================================================
AGGR.PERIOD <- 'Q'     # квартал
# AGGR.PERIOD <- 'Y'     # год
# ЗАГРУЗКА ДАННЫХ --------------------------------------------------------------
#  2013 ========================================================================
DT.imp.2013 <- loadAndFilterDataByYear(2013, aggr.period = AGGR.PERIOD)
DT.imp.2013 <- DT.imp.2013[!(co_or %in% c('KAZ', 'RUS', 'BEL'))]
# прицепляем флаг на страны эмбарго
DT.2013 <- merge(DT.imp.2013, dt.co_or.coords[, c('co_or', 'co_emb_sinse_14',
'co_emb_sinse_15',
'GDP_2013_mln_doll', 'area',
'in_EU')],
by.x = 'co_or', by.y = 'co_or')
#  2014 ========================================================================
DT.imp.2014 <- loadAndFilterDataByYear(2014, aggr.period = AGGR.PERIOD)
# прицепляем флаг на страны эмбарго
DT.2014 <- merge(DT.imp.2014, dt.co_or.coords[, c('co_or', 'co_emb_sinse_14',
'co_emb_sinse_15',
'GDP_2013_mln_doll', 'area',
'in_EU')],
by.x = 'co_or', by.y = 'co_or')
#  2015 ========================================================================
DT.imp.2015 <- loadAndFilterDataByYear(2015, aggr.period = AGGR.PERIOD)
# прицепляем флаг на страны эмбарго
DT.2015 <- merge(DT.imp.2015, dt.co_or.coords[, c('co_or', 'co_emb_sinse_14',
'co_emb_sinse_15',
'GDP_2013_mln_doll', 'area',
'in_EU')],
by.x = 'co_or', by.y = 'co_or')
corr.test(DT.2013$ves_ne, DT.2013$stoim)
??corr.test
cor.test(DT.2013$ves_ne, DT.2013$stoim)
cor.test(DT.2013$ves_br, DT.2013$stoim)
cor.test(DT.2013$ves_ne, DT.2013$stoim)
cor.test(DT.2013$ves_br, DT.2013$stoim)
cor.test(DT.2014$ves_ne, DT.2013$stoim)
cor.test(DT.2013$ves_ne, DT.2013$stoim)
cor.test(DT.2013$ves_br, DT.2013$stoim)
cor.test(DT.2014$ves_ne, DT.2014$stoim)
cor.test(DT.2014$ves_br, DT.2014$stoim)
cor.test(DT.2015$ves_ne, DT.2015$stoim)
cor.test(DT.2015$ves_br, DT.2015$stoim)
my.seed
my.seed <- 12345
set.seed(my.seed)
plot(sample(DT.2013$ves_ne, size = 1000), sample(DT.2013$stoim, size = 1000),
xlab = 'ves_ne', ylab = 'stoim', main = '2013')
plot(sample(DT.2013$ves_ne, size = 1000), sample(DT.2013$stoim, size = 1000),
xlab = 'ves_ne', ylab = 'stoim', main = '2013', pch = '·')
cor.test(DT.2013$ves_ne, DT.2013$stoim)
cor.test(DT.2013$ves_br, DT.2013$stoim)
set.seed(my.seed)
plot(sample(DT.2013$ves_ne, size = 1000), sample(DT.2013$stoim, size = 1000),
xlab = 'ves_ne', ylab = 'stoim', main = '2013', pch = '·')
cor.test(DT.2014$ves_ne, DT.2014$stoim)
cor.test(DT.2014$ves_br, DT.2014$stoim)
set.seed(my.seed)
plot(sample(DT.2014$ves_ne, size = 1000), sample(DT.2014$stoim, size = 1000),
xlab = 'ves_ne', ylab = 'stoim', main = '2014', pch = '·')
cor.test(DT.2015$ves_ne, DT.2015$stoim)
cor.test(DT.2015$ves_br, DT.2015$stoim)
set.seed(my.seed)
plot(sample(DT.2015$ves_ne, size = 1000), sample(DT.2015$stoim, size = 1000),
xlab = 'ves_ne', ylab = 'stoim', main = '2015', pch = '·')
DT.2013
dt <- DT.2013[, c('name_pp', 'ves_ne'), with = F]
dt
dt[, lapply(.SD, sum), by = name_pp]
dt[, lapply(.SD, sum), by = name_pp][order(-ves_ne)]
dt <- dt[, lapply(.SD, sum), by = name_pp][order(-ves_ne)]
dt.pp.coords
DT.2013
dt <- merge(dt, DT.2013[, c('name_pp', 'code_tra'), with = F], by = 'name_pp')
dt
# п.п. -- лидеры по тоннажу
dt <- DT.2013[, c('name_pp', 'ves_ne'), with = F]
dt <- dt[, lapply(.SD, sum), by = name_pp][order(-ves_ne)]
dt <- unique(merge(dt, DT.2013[, c('name_pp', 'code_tra'), with = F],
by = 'name_pp'))
dt <- unique(merge(dt, dt.pp.coords[, c('name_pp', 'border_name'),
with = F], by = 'name_pp'))
dt
dt[, code_tra_name := code.tra.names[dt$code_tra]]
code.tra.names <- c('мор', 'ж/д', 'а/м', 'воз')
names(code.tra.names) <- seq(10, 40, by = 10)
# п.п. -- лидеры по тоннажу
dt <- DT.2013[, c('name_pp', 'ves_ne'), with = F]
dt <- dt[, lapply(.SD, sum), by = name_pp][order(-ves_ne)]
dt <- unique(merge(dt, DT.2013[, c('name_pp', 'code_tra'), with = F],
by = 'name_pp'))
dt <- unique(merge(dt, dt.pp.coords[, c('name_pp', 'border_name'),
with = F], by = 'name_pp'))
dt[, code_tra_name := code.tra.names[dt$code_tra]]
dt
dt[, ves_ne.prc := round(ves_ne / sum(dt$ves_ne) * 100, 1)]
dt
dt[order(-ves_ne), ]
dt[order(-ves_ne), c('name_pp', 'ves_ne.prc', 'code_tra_name')]
dt[order(-ves_ne), c('name_pp', 'ves_ne.prc', 'code_tra_name')][1:10. ]
dt[order(-ves_ne), c('name_pp', 'ves_ne.prc', 'code_tra_name')][1:10, ]
dt[order(-ves_ne), c('name_pp', 'ves_ne.prc', 'code_tra_name', 'border_name')][1:10, ]
# только автомобильные
dt <- DT.2013[code_tra == '30', c('name_pp', 'ves_ne'), with = F]
dt <- dt[, lapply(.SD, sum), by = name_pp][order(-ves_ne)]
dt <- unique(merge(dt, DT.2013[, c('name_pp', 'code_tra'), with = F],
by = 'name_pp'))
dt <- unique(merge(dt, dt.pp.coords[, c('name_pp', 'border_name'),
with = F], by = 'name_pp'))
dt[, code_tra_name := code.tra.names[dt$code_tra]]
dt[, ves_ne.prc := round(ves_ne / sum(dt$ves_ne) * 100, 1)]
dt[order(-ves_ne), c('name_pp', 'ves_ne.prc', 'code_tra_name', 'border_name')][1:10, ]
dt <- DT.2015[code_tra == '30', c('name_pp', 'ves_ne'), with = F]
dt <- dt[, lapply(.SD, sum), by = name_pp][order(-ves_ne)]
dt <- unique(merge(dt, DT.2013[, c('name_pp', 'code_tra'), with = F],
by = 'name_pp'))
dt <- unique(merge(dt, dt.pp.coords[, c('name_pp', 'border_name'),
with = F], by = 'name_pp'))
dt[, code_tra_name := code.tra.names[dt$code_tra]]
dt[, ves_ne.prc := round(ves_ne / sum(dt$ves_ne) * 100, 1)]
dt[order(-ves_ne), c('name_pp', 'ves_ne.prc', 'code_tra_name', 'border_name')][1:10, ]
dt[order(-ves_ne), c('name_pp', 'ves_ne.prc', 'code_tra_name', 'border_name')][1:20, ]
# сентябрь-декабрь
dt <- DT.2013[year %in% c('2015.09', '2015.10', '2015.11', '2015.12'),
c('name_pp', 'ves_ne'), with = F]
dt <- dt[, lapply(.SD, sum), by = name_pp][order(-ves_ne)]
dt <- unique(merge(dt, DT.2013[, c('name_pp', 'code_tra'), with = F],
by = 'name_pp'))
dt <- unique(merge(dt, dt.pp.coords[, c('name_pp', 'border_name'),
with = F], by = 'name_pp'))
dt[, code_tra_name := code.tra.names[dt$code_tra]]
dt[, ves_ne.prc := round(ves_ne / sum(dt$ves_ne) * 100, 1)]
dt[order(-ves_ne), c('name_pp', 'ves_ne.prc', 'code_tra_name', 'border_name')][1:10, ]
# сентябрь-декабрь
dt <- DT.2013[year %in% c('2013.09', '2013.10', '2013.11', '2013.12'),
c('name_pp', 'ves_ne'), with = F]
dt <- dt[, lapply(.SD, sum), by = name_pp][order(-ves_ne)]
dt <- unique(merge(dt, DT.2013[, c('name_pp', 'code_tra'), with = F],
by = 'name_pp'))
dt <- unique(merge(dt, dt.pp.coords[, c('name_pp', 'border_name'),
with = F], by = 'name_pp'))
dt[, code_tra_name := code.tra.names[dt$code_tra]]
dt[, ves_ne.prc := round(ves_ne / sum(dt$ves_ne) * 100, 1)]
dt[order(-ves_ne), c('name_pp', 'ves_ne.prc', 'code_tra_name', 'border_name')][1:10, ]
dt <- DT.2013[code_tra == '30' & year %in% c('2013.09', '2013.10', '2013.11', '2013.12'),
c('name_pp', 'ves_ne'), with = F]
dt <- dt[, lapply(.SD, sum), by = name_pp][order(-ves_ne)]
dt <- unique(merge(dt, DT.2013[, c('name_pp', 'code_tra'), with = F],
by = 'name_pp'))
dt <- unique(merge(dt, dt.pp.coords[, c('name_pp', 'border_name'),
with = F], by = 'name_pp'))
dt[, code_tra_name := code.tra.names[dt$code_tra]]
dt[, ves_ne.prc := round(ves_ne / sum(dt$ves_ne) * 100, 1)]
dt[order(-ves_ne), c('name_pp', 'ves_ne.prc', 'code_tra_name', 'border_name')][1:10, ]
dt <- DT.2015[code_tra == '30' & year %in% c('2015.09', '2015.10', '2015.11', '2016.12'),
c('name_pp', 'ves_ne'), with = F]
dt <- dt[, lapply(.SD, sum), by = name_pp][order(-ves_ne)]
dt <- unique(merge(dt, DT.2013[, c('name_pp', 'code_tra'), with = F],
by = 'name_pp'))
dt <- unique(merge(dt, dt.pp.coords[, c('name_pp', 'border_name'),
with = F], by = 'name_pp'))
dt[, code_tra_name := code.tra.names[dt$code_tra]]
dt[, ves_ne.prc := round(ves_ne / sum(dt$ves_ne) * 100, 1)]
dt[order(-ves_ne), c('name_pp', 'ves_ne.prc', 'code_tra_name', 'border_name')][1:10, ]
sum(dt$ves_ne)
sum(dt$ves_ne) / 1000 / 1000
dt <- DT.2015[code_tra == '30',
c('name_pp', 'ves_ne'), with = F]
dt <- dt[, lapply(.SD, sum), by = name_pp][order(-ves_ne)]
dt <- unique(merge(dt, DT.2013[, c('name_pp', 'code_tra'), with = F],
by = 'name_pp'))
dt <- unique(merge(dt, dt.pp.coords[, c('name_pp', 'border_name'),
with = F], by = 'name_pp'))
dt[, code_tra_name := code.tra.names[dt$code_tra]]
dt[, ves_ne.prc := round(ves_ne / sum(dt$ves_ne) * 100, 1)]
dt[order(-ves_ne), c('name_pp', 'ves_ne.prc', 'code_tra_name', 'border_name')][1:10, ]
sum(dt$ves_ne) / 1000 / 1000
# январь-декабрь
dt <- DT.2013[, c('name_pp', 'ves_ne'), with = F]
dt <- dt[, lapply(.SD, sum), by = name_pp][order(-ves_ne)]
dt <- unique(merge(dt, DT.2013[, c('name_pp', 'code_tra'), with = F],
by = 'name_pp'))
dt <- unique(merge(dt, dt.pp.coords[, c('name_pp', 'border_name'),
with = F], by = 'name_pp'))
dt[, code_tra_name := code.tra.names[dt$code_tra]]
dt[, ves_ne.prc := round(ves_ne / sum(dt$ves_ne) * 100, 1)]
dt[order(-ves_ne), c('name_pp', 'ves_ne.prc', 'code_tra_name', 'border_name')][1:10, ]
sum(dt$ves_ne) / 1000 / 1000
# январь-декабрь
dt <- DT.2013[code_tra == '30',
c('name_pp', 'ves_ne'), with = F]
dt <- dt[, lapply(.SD, sum), by = name_pp][order(-ves_ne)]
dt <- unique(merge(dt, DT.2013[, c('name_pp', 'code_tra'), with = F],
by = 'name_pp'))
dt <- unique(merge(dt, dt.pp.coords[, c('name_pp', 'border_name'),
with = F], by = 'name_pp'))
dt[, code_tra_name := code.tra.names[dt$code_tra]]
dt[, ves_ne.prc := round(ves_ne / sum(dt$ves_ne) * 100, 1)]
dt[order(-ves_ne), c('name_pp', 'ves_ne.prc', 'code_tra_name', 'border_name')][1:10, ]
sum(dt$ves_ne) / 1000 / 1000
# сентябрь-декабрь
dt <- DT.2013[code_tra == '30' & year %in% c('2013.09', '2013.10', '2013.11', '2013.12'),
c('name_pp', 'ves_ne'), with = F]
dt <- dt[, lapply(.SD, sum), by = name_pp][order(-ves_ne)]
dt <- unique(merge(dt, DT.2013[, c('name_pp', 'code_tra'), with = F],
by = 'name_pp'))
dt <- unique(merge(dt, dt.pp.coords[, c('name_pp', 'border_name'),
with = F], by = 'name_pp'))
dt[, code_tra_name := code.tra.names[dt$code_tra]]
dt[, ves_ne.prc := round(ves_ne / sum(dt$ves_ne) * 100, 1)]
dt[order(-ves_ne), c('name_pp', 'ves_ne.prc', 'code_tra_name', 'border_name')][1:10, ]
sum(dt$ves_ne) / 1000 / 1000
# январь-декабрь
dt <- DT.2013[, c('name_pp', 'ves_ne'), with = F]
dt <- dt[, lapply(.SD, sum), by = name_pp][order(-ves_ne)]
dt <- unique(merge(dt, DT.2013[, c('name_pp', 'code_tra'), with = F],
by = 'name_pp'))
dt <- unique(merge(dt, dt.pp.coords[, c('name_pp', 'border_name'),
with = F], by = 'name_pp'))
dt[, code_tra_name := code.tra.names[dt$code_tra]]
dt[, ves_ne.prc := round(ves_ne / sum(dt$ves_ne) * 100, 1)]
dt[order(-ves_ne), c('name_pp', 'ves_ne.prc', 'code_tra_name', 'border_name')][1:10, ]
sum(dt$ves_ne) / 1000 / 1000
# январь-декабрь
dt <- DT.2015[, c('name_pp', 'ves_ne'), with = F]
dt <- dt[, lapply(.SD, sum), by = name_pp][order(-ves_ne)]
dt <- unique(merge(dt, DT.2013[, c('name_pp', 'code_tra'), with = F],
by = 'name_pp'))
dt <- unique(merge(dt, dt.pp.coords[, c('name_pp', 'border_name'),
with = F], by = 'name_pp'))
dt[, code_tra_name := code.tra.names[dt$code_tra]]
dt[, ves_ne.prc := round(ves_ne / sum(dt$ves_ne) * 100, 1)]
dt[order(-ves_ne), c('name_pp', 'ves_ne.prc', 'code_tra_name', 'border_name')][1:10, ]
sum(dt$ves_ne) / 1000 / 1000
# сентябрь-декабрь
dt <- DT.2013[year %in% c('2013.09', '2013.10', '2013.11', '2013.12'),
c('name_pp', 'ves_ne'), with = F]
dt <- dt[, lapply(.SD, sum), by = name_pp][order(-ves_ne)]
dt <- unique(merge(dt, DT.2013[, c('name_pp', 'code_tra'), with = F],
by = 'name_pp'))
dt <- unique(merge(dt, dt.pp.coords[, c('name_pp', 'border_name'),
with = F], by = 'name_pp'))
dt[, code_tra_name := code.tra.names[dt$code_tra]]
dt[, ves_ne.prc := round(ves_ne / sum(dt$ves_ne) * 100, 1)]
dt[order(-ves_ne), c('name_pp', 'ves_ne.prc', 'code_tra_name', 'border_name')][1:10, ]
sum(dt$ves_ne) / 1000 / 1000
dt[order(-ves_ne), c('name_pp', 'ves_ne.prc', 'code_tra_name', 'border_name')][1:20, ]
# сентябрь-декабрь
dt <- DT.2015[code_tra == '30' & year %in% c('2015.09', '2015.10', '2015.11', '2016.12'),
c('name_pp', 'ves_ne'), with = F]
dt <- dt[, lapply(.SD, sum), by = name_pp][order(-ves_ne)]
dt <- unique(merge(dt, DT.2013[, c('name_pp', 'code_tra'), with = F],
by = 'name_pp'))
dt <- unique(merge(dt, dt.pp.coords[, c('name_pp', 'border_name'),
with = F], by = 'name_pp'))
dt[, code_tra_name := code.tra.names[dt$code_tra]]
dt[, ves_ne.prc := round(ves_ne / sum(dt$ves_ne) * 100, 1)]
dt[order(-ves_ne), c('name_pp', 'ves_ne.prc', 'code_tra_name', 'border_name')][1:20, ]
sum(dt$ves_ne) / 1000 / 1000
# сентябрь-декабрь
dt <- DT.2015[year %in% c('2015.09', '2015.10', '2015.11', '2016.12'),
c('name_pp', 'ves_ne'), with = F]
dt <- dt[, lapply(.SD, sum), by = name_pp][order(-ves_ne)]
dt <- unique(merge(dt, DT.2013[, c('name_pp', 'code_tra'), with = F],
by = 'name_pp'))
dt <- unique(merge(dt, dt.pp.coords[, c('name_pp', 'border_name'),
with = F], by = 'name_pp'))
dt[, code_tra_name := code.tra.names[dt$code_tra]]
dt[, ves_ne.prc := round(ves_ne / sum(dt$ves_ne) * 100, 1)]
dt[order(-ves_ne), c('name_pp', 'ves_ne.prc', 'code_tra_name', 'border_name')][1:20, ]
sum(dt$ves_ne) / 1000 / 1000
# январь-декабрь
dt <- DT.2013[code_tra == '30',
c('name_pp', 'ves_ne'), with = F]
dt <- dt[, lapply(.SD, sum), by = name_pp][order(-ves_ne)]
dt <- unique(merge(dt, DT.2013[, c('name_pp', 'code_tra'), with = F],
by = 'name_pp'))
dt <- unique(merge(dt, dt.pp.coords[, c('name_pp', 'border_name'),
with = F], by = 'name_pp'))
dt[, code_tra_name := code.tra.names[dt$code_tra]]
dt[, ves_ne.prc := round(ves_ne / sum(dt$ves_ne) * 100, 1)]
dt[order(-ves_ne), c('name_pp', 'ves_ne.prc', 'code_tra_name', 'border_name')][1:20, ]
sum(dt$ves_ne) / 1000 / 1000
# январь-декабрь
dt <- DT.2015[code_tra == '30',
c('name_pp', 'ves_ne'), with = F]
dt <- dt[, lapply(.SD, sum), by = name_pp][order(-ves_ne)]
dt <- unique(merge(dt, DT.2013[, c('name_pp', 'code_tra'), with = F],
by = 'name_pp'))
dt <- unique(merge(dt, dt.pp.coords[, c('name_pp', 'border_name'),
with = F], by = 'name_pp'))
dt[, code_tra_name := code.tra.names[dt$code_tra]]
dt[, ves_ne.prc := round(ves_ne / sum(dt$ves_ne) * 100, 1)]
dt[order(-ves_ne), c('name_pp', 'ves_ne.prc', 'code_tra_name', 'border_name')][1:20, ]
sum(dt$ves_ne) / 1000 / 1000
# январь-декабрь
dt <- DT.2013[code_tra == '30', tov_emb == 1,
c('name_pp', 'ves_ne'), with = F]
DT.2013
# январь-декабрь
dt <- DT.2013[code_tra == '30' & tov_emb == 1,
c('name_pp', 'ves_ne'), with = F]
dt <- dt[, lapply(.SD, sum), by = name_pp][order(-ves_ne)]
dt <- unique(merge(dt, DT.2013[, c('name_pp', 'code_tra'), with = F],
by = 'name_pp'))
dt <- unique(merge(dt, dt.pp.coords[, c('name_pp', 'border_name'),
with = F], by = 'name_pp'))
dt[, code_tra_name := code.tra.names[dt$code_tra]]
dt[, ves_ne.prc := round(ves_ne / sum(dt$ves_ne) * 100, 1)]
dt[order(-ves_ne), c('name_pp', 'ves_ne.prc', 'code_tra_name', 'border_name')][1:20, ]
sum(dt$ves_ne) / 1000 / 1000
# автомобильные п.п. и эмбарго товары
# январь-декабрь
dt <- DT.2015[code_tra == '30' & tov_emb == 1,
c('name_pp', 'ves_ne'), with = F]
dt <- dt[, lapply(.SD, sum), by = name_pp][order(-ves_ne)]
dt <- unique(merge(dt, DT.2013[, c('name_pp', 'code_tra'), with = F],
by = 'name_pp'))
dt <- unique(merge(dt, dt.pp.coords[, c('name_pp', 'border_name'),
with = F], by = 'name_pp'))
dt[, code_tra_name := code.tra.names[dt$code_tra]]
dt[, ves_ne.prc := round(ves_ne / sum(dt$ves_ne) * 100, 1)]
dt[order(-ves_ne), c('name_pp', 'ves_ne.prc', 'code_tra_name', 'border_name')][1:20, ]
sum(dt$ves_ne) / 1000 / 1000
# январь-декабрь
dt <- DT.2015[tov_emb == 1,
c('name_pp', 'ves_ne'), with = F]
dt <- dt[, lapply(.SD, sum), by = name_pp][order(-ves_ne)]
dt <- unique(merge(dt, DT.2013[, c('name_pp', 'code_tra'), with = F],
by = 'name_pp'))
dt <- unique(merge(dt, dt.pp.coords[, c('name_pp', 'border_name'),
with = F], by = 'name_pp'))
dt[, code_tra_name := code.tra.names[dt$code_tra]]
dt[, ves_ne.prc := round(ves_ne / sum(dt$ves_ne) * 100, 1)]
dt[order(-ves_ne), c('name_pp', 'ves_ne.prc', 'code_tra_name', 'border_name')][1:20, ]
sum(dt$ves_ne) / 1000 / 1000
# автомобильные п.п. и эмбарго товары
# январь-декабрь
dt <- DT.2013[code_tra == '30' & tov_emb == 1,
c('name_pp', 'ves_ne'), with = F]
dt <- dt[, lapply(.SD, sum), by = name_pp][order(-ves_ne)]
dt <- unique(merge(dt, DT.2013[, c('name_pp', 'code_tra'), with = F],
by = 'name_pp'))
dt <- unique(merge(dt, dt.pp.coords[, c('name_pp', 'border_name'),
with = F], by = 'name_pp'))
dt[, code_tra_name := code.tra.names[dt$code_tra]]
dt[, ves_ne.prc := round(ves_ne / sum(dt$ves_ne) * 100, 1)]
dt[order(-ves_ne), c('name_pp', 'ves_ne.prc', 'code_tra_name', 'border_name')][1:20, ]
sum(dt$ves_ne) / 1000 / 1000
# автомобильные п.п. и эмбарго товары
# январь-декабрь
dt <- DT.2013[code_tra == '30' & tov_emb == 1,
c('name_pp', 'ves_ne'), with = F]
dt <- dt[, lapply(.SD, sum), by = name_pp][order(-ves_ne)]
dt <- unique(merge(dt, DT.2013[, c('name_pp', 'code_tra'), with = F],
by = 'name_pp'))
dt <- unique(merge(dt, dt.pp.coords[, c('name_pp', 'border_name'),
with = F], by = 'name_pp'))
dt[, code_tra_name := code.tra.names[dt$code_tra]]
dt[, ves_ne.prc := round(ves_ne / sum(dt$ves_ne) * 100, 1)]
dt[order(-ves_ne), c('name_pp', 'ves_ne.prc', 'code_tra_name', 'border_name')][1:20, ]
sum(dt$ves_ne) / 1000 / 1000
# автомобильные п.п. и эмбарго товары
# январь-декабрь
dt <- DT.2015[code_tra == '30' & tov_emb == 1,
c('name_pp', 'ves_ne'), with = F]
dt <- dt[, lapply(.SD, sum), by = name_pp][order(-ves_ne)]
dt <- unique(merge(dt, DT.2015[, c('name_pp', 'code_tra'), with = F],
by = 'name_pp'))
dt <- unique(merge(dt, dt.pp.coords[, c('name_pp', 'border_name'),
with = F], by = 'name_pp'))
dt[, code_tra_name := code.tra.names[dt$code_tra]]
dt[, ves_ne.prc := round(ves_ne / sum(dt$ves_ne) * 100, 1)]
dt[order(-ves_ne), c('name_pp', 'ves_ne.prc', 'code_tra_name', 'border_name')][1:20, ]
sum(dt$ves_ne) / 1000 / 1000
setwd("~/GitHub/zakupki_gov_ru")
